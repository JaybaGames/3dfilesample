<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
	body {
		background: rgb(40,40,40);
	}
	
	@font-face {
        font-family: 'main';
        src: url('fonts/main.otf');
    }
	@font-face {
        font-family: 'main_bold';
        src: url('fonts/main_bold.ttf');
    }
	@font-face {
        font-family: 'main_black';
        src: url('fonts/main_black.otf');
    }
	@font-face {
        font-family: 'bebas';
        src: url('fonts/bebas.ttf');
    }
	
    * {
        font-family: main;
		margin: 0;
		color: white;
		user-select: none;
    }
	
	header {
		height: 50vh;
		overflow: hidden;
		position: relative;
	}
	
	header img {
		width: 110%;
		height: 95%;
		object-fit: cover;
		object-position: center;
		translate: 0vw;
		filter: brightness(0%);
		animation: anim 15s linear infinite;
	}
	
	@keyframes anim {
		0% {
			filter: brightness(0%);
			translate: 0vw
		}
		5% {filter: brightness(100%)}
		45% {filter: brightness(100%)}
		50% {
			filter: brightness(0%);
			translate: -10vw;
		}
		55% {filter: brightness(100%)}
		95% {filter: brightness(100%)}
		100% {
			filter: brightness(0%);
			translate: 0vw
		}
	}
	
	header div {
		width: 100%;
		height: 50%;
		background-image: linear-gradient(rgba(40,40,40,0), rgba(40,40,40,1) 80%);
		bottom: 0%;
		position: absolute;
	}
	
	main {
		position: absolute;
		left: 50%;
		top: 45%;
		transform: translate(-50%, -50%);
		display: grid;
		gap: 10px;
	}
	
	main > div {
		display: flex;
		width: max-content;
		gap: 18px;
		position: relative;
		align-items: center;
		margin: auto;
	}
	
	h1 {
		font-family: main;
		font-size: 140%;
		font-weight: 500;
	}
	
	#mainButton {
		background-image: linear-gradient(rgb(100,100,200), rgb(25, 25, 120));
		border-radius: 7px;
		display: flex;
		align-items: center;
		gap: 10px;
		justify-content: space-between;
		min-width: 110px;
		padding: 7px 12px;
		cursor: pointer;
		filter: saturate(0.5) contrast(0.5);
	}
	
	#mainButton:hover {
		filter: brightness(90%) !important;
	}
	
	#mainButton p {
		font-family: main_bold;
		text-shadow: 0px 2.5px 2px rgba(0,0,0,0.5);
		text-align: center;
		width: 100%;
		font-size: 80%;
	}
	
	#mainButton .svgs {
		display: none;
	}
	
	div > :has(h1) {
		height: min-content;
		width: 140px;
		gap: 5px;
		display: grid;
	}
	
	#installedStatus {
		position: absolute;
		top: 100%;
		display: none;
	}
	
	aside {
		display: flex;
		gap: 5px;
		width: max-content;
		margin: auto;
		cursor: pointer;
		position: absolute;
		bottom: 0%;
		left: 50%;
		transform: translateX(-50%);
		opacity: 0;
		transition: opacity 0.2s, bottom 0.2s;
	}
	
	aside p {
		font-size: 80%;
	}
	
	#checkbox {
		filter: none !important;
	}
	
	.svgs {
		width: 15px;
		height: 15px;
		filter: invert(1) drop-shadow(0px 5px 2px rgba(0,0,0,0.3));
	}
	
	footer {
		width: min-content;
		display: grid;
		gap: 5px;
		position: absolute;
		bottom: 7vh;
		left: 50%;
		transform: translateX(-50%);
	}
	
	footer > p {
		font-size: 60%;
		font-family: main_bold;
		margin: auto;
		width: max-content;
	}
	
	footer div {
		display: flex;
		align-items: center;
		gap: 5px;
	}
	
	footer div p {
		font-family: bebas;
		width: min-content;
		line-height: 100%;
		font-size: 110%;
	}
	
	#info {
		position: absolute;
		right: 7vh;
		bottom: 7vh;
		cursor: pointer;
	}
	
	#info:hover {
		filter: brightness(120%);
	}
	
	@media (min-aspect-ratio: 1/1) {
		main img {height: 90px}
		footer img {height: 40px}
		#info {height: 25px}
	}
	
	@media (max-aspect-ratio: 1/1) {
		main img {width: 90px}
		footer img {width: 40px}
		#info {width: 25px}
	}
</style>

<body>
	<header>
		<img>
		<div></div>
	</header>
	<main>
		<div>
			<div>
				<img src="app_logo.png">
			</div>
			<div>
				<h1>Demacorn</h1>
				<div id="mainButton">
					<p>LOADING...</p>
					<img class="svgs" src="icons/cancel.svg">
				</div>
				<div id="installedStatus">
					<img class="svgs" src="icons/check.svg">
					<p>Installed</p>
				</div>
			</div>
		</div>
		<aside>
			<img id="checkbox" class="svgs" src="icons/checkbox_unchecked.svg">
			<p>Start the game automatically after installation</p>
		</aside>
	</main>
	<footer title="Credits to the development owner, Jayvee Erandio">
		<p>Developed by</p>
		<div>
			<img src="developer_logo.png">
			<p>PSYCHO TUMBLER</p>
		</div>
	</footer>
	<img id="info" title="More Information" src="icons/info.svg">
</body>

<script>
	let thisFrame;
	const mainButton = document.querySelector("#mainButton");
	for (let iframe of window.parent.document.getElementsByTagName('iframe')) 
		if (iframe.contentWindow === window) {
			thisFrame = iframe;
			break;
		}
	thisFrame.style.cssText = `
		position: fixed; 	z-index: 999; 
		border: 0; 			width: 100%; 
		height: 100%; 		top: 0%; 
		left: 0%
	`;
	
	const aside = document.querySelector("aside");
	const checkbox = document.querySelector("#checkbox");
	let autoPlay = false;
	aside.onclick = function(){
		if(!autoPlay){
			checkbox.setAttribute("src", "icons/checkbox_checked.svg");
			autoPlay = true;
		}
		else {
			checkbox.setAttribute("src", "icons/checkbox_unchecked.svg");
			autoPlay = false;
		}
	}
	
	// COVERSHOTS SLIDESHOW =============================================
	const slideshowImages = [];
	let index = 1;

	function loadNextImage() {
		const img = new Image();
		const src = "covershots/pic" + index + ".png";

		img.onload = () => {
			slideshowImages.push(src);
			index++;
			loadNextImage();
		}

		img.onerror = () => {
			startSlideshow();
		};

		img.src = src;
	}
	loadNextImage();

	let slideIndex = 0;
	const slideshow = document.querySelector("header img");
	const timeStamp = parseInt(getComputedStyle(slideshow).animationDuration.slice(0,-1)) * 500

	function startSlideshow() {
		if (!slideshowImages.length) return;

		slideshow.src = slideshowImages[0];
		
		let isDimming = false;
		const anim = function(){
		requestAnimationFrame(anim);
			if(parseFloat(getComputedStyle(slideshow).filter.slice(11, -1)) < 0.08 && !isDimming){
				isDimming = true;
				slideIndex = (slideIndex + 1) % slideshowImages.length;
				slideshow.src = slideshowImages[slideIndex];
			}
			else if (parseFloat(getComputedStyle(slideshow).filter.slice(11, -1)) >= 0.08 && isDimming){
				isDimming = false;
			}
		}
		setTimeout(anim, timeStamp/2);
	};
	
	// INITIAL SETUP & INSTALLMENT ===========================
	let isInstalled = true;
	let installPrompt = null;
	
	function modePlay(){
		document.querySelector("#mainButton p").innerHTML = "PLAY";
		mainButton.onclick = function() {
			thisFrame.remove();
		};
		mainButton.style.filter = "none";
	}
	
	window.parent.onbeforeinstallprompt = function(e) {
		installPrompt = e;
	};
	window.parent.onappinstalled = function(){
		modePlay();
	}
	
	window.parent.addEventListener('beforeinstallprompt', (e) => {
		isInstalled = false;
		document.querySelector("#mainButton p").innerHTML = "INSTALL";
		mainButton.onclick = function() {
			showInstall();
		};
		mainButton.style.filter = "none";
	});
	window.onload = function(){
		if(isInstalled){
			modePlay();
		}
	}
	
	async function showInstall(){
		if (!installPrompt) return;
		installPrompt.prompt(); 
		installPrompt = null;
	}
</script>
